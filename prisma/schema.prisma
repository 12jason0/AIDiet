generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://aidiet:%40o5334044112@127.0.0.1:3306/ai_diet"
}

model cart {
  id        Int        @id @default(autoincrement())
  user_id   Int        @unique(map: "Cart_user_id_key")
  createdAt DateTime   @default(now())
  updatedAt DateTime
  user      user       @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "Cart_user_id_fkey")
  cartitem  cartitem[]
}

model cartitem {
  id            Int        @id @default(autoincrement())
  cart_id       Int
  ingredient_id Int
  quantity      Float?
  unit          String?
  cart          cart       @relation(fields: [cart_id], references: [id], onDelete: Cascade, map: "CartItem_cart_id_fkey")
  ingredient    ingredient @relation(fields: [ingredient_id], references: [id], onDelete: Cascade, map: "CartItem_ingredient_id_fkey")

  @@index([cart_id], map: "CartItem_cart_id_idx")
  @@index([ingredient_id], map: "CartItem_ingredient_id_idx")
}

model goal {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  @db.Text
  recipe      recipe[]
}

model ingredient {
  id               Int                @id @default(autoincrement())
  name             String
  category         String
  image_url        String?            @db.Text
  nutrition_id     Int?               @unique(map: "Ingredient_nutrition_id_key")
  cartitem         cartitem[]
  recipeingredient recipeingredient[]
}

model mealplan {
  id             Int              @id @default(autoincrement())
  user_id        Int
  date           DateTime
  type           String
  user           user             @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "MealPlan_user_id_fkey")
  mealplanrecipe mealplanrecipe[]

  @@index([date], map: "MealPlan_date_idx")
  @@index([user_id], map: "MealPlan_user_id_idx")
}

model mealplanrecipe {
  id          Int      @id @default(autoincrement())
  mealplan_id Int
  recipe_id   Int
  mealplan    mealplan @relation(fields: [mealplan_id], references: [id], onDelete: Cascade, map: "MealPlanRecipe_mealplan_id_fkey")
  recipe      recipe   @relation(fields: [recipe_id], references: [id], onDelete: Cascade, map: "MealPlanRecipe_recipe_id_fkey")

  @@index([mealplan_id], map: "MealPlanRecipe_mealplan_id_idx")
  @@index([recipe_id], map: "MealPlanRecipe_recipe_id_idx")
}

model nutrition {
  id      Int    @id @default(autoincrement())
  kcal    Float?
  protein Float?
  fat     Float?
  carbs   Float?
  sugar   Float?
  fiber   Float?
  sodium  Float?
}

model recipe {
  id                Int                 @id @default(autoincrement())
  name              String
  description       String?             @db.Text
  cooking_time      Int?
  difficulty        String?
  image_url         String?
  instructions      Json?
  goal_id           Int?
  mealplanrecipe    mealplanrecipe[]
  goal              goal?               @relation(fields: [goal_id], references: [id], onUpdate: NoAction, map: "fk_recipe_goal")
  recipeingredient  recipeingredient[]
  recommendationlog recommendationlog[]

  @@index([goal_id], map: "fk_recipe_goal")
}

model recipeingredient {
  id            Int        @id @default(autoincrement())
  recipe_id     Int
  ingredient_id Int
  amount        Float?
  unit          String?
  ingredient    ingredient @relation(fields: [ingredient_id], references: [id], onDelete: Cascade, map: "RecipeIngredient_ingredient_id_fkey")
  recipe        recipe     @relation(fields: [recipe_id], references: [id], onDelete: Cascade, map: "RecipeIngredient_recipe_id_fkey")

  @@index([ingredient_id], map: "RecipeIngredient_ingredient_id_idx")
  @@index([recipe_id], map: "RecipeIngredient_recipe_id_idx")
}

model recommendationlog {
  id            Int      @id @default(autoincrement())
  user_id       Int
  recipe_id     Int
  recommendedAt DateTime @default(now())
  liked         Boolean? @default(false)
  recipe        recipe   @relation(fields: [recipe_id], references: [id], onDelete: Cascade, map: "RecommendationLog_recipe_id_fkey")
  user          user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "RecommendationLog_user_id_fkey")

  @@index([recipe_id], map: "RecommendationLog_recipe_id_idx")
  @@index([user_id], map: "RecommendationLog_user_id_idx")
}

model user {
  id                  Int                 @id @default(autoincrement())
  name                String
  gender              String?
  email               String
  passwordHash        String
  age                 Int?
  goal                String?
  calorie_target      Float?
  allergies           Json?
  dislike_ingredients Json?
  createdAt           DateTime            @default(now())
  cart                cart?
  mealplan            mealplan[]
  recommendationlog   recommendationlog[]
}
