generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/* ------------------------------
   üßç USER & PROFILE
--------------------------------*/
model USER {
  user_id        Int                 @id @default(autoincrement())
  email          String              @unique
  password       String
  name           String
  created_at     DateTime            @default(now())
  profile        USER_PROFILE?
  mealCerts      MEAL_CERTIFICATION[]
  carts          CART[]
  posts          POST[]
  comments       COMMENT[]
  coupons        COUPON[]
  weeklyPlans    WEEKLY_MEAL_PLAN[]
}

/* ------------------------------
   üìä USER_PROFILE
--------------------------------*/
model USER_PROFILE {
  profile_id  Int      @id @default(autoincrement())
  user_id     Int      @unique
  height      Float?
  weight      Float?
  bmi         Float?
  disease     String?
  goal        String?
  updated_at  DateTime @updatedAt

  user        USER     @relation(fields: [user_id], references: [user_id])
}

/* ------------------------------
   üóì WEEKLY & DAILY MEAL PLAN
--------------------------------*/
model WEEKLY_MEAL_PLAN {
  plan_id     Int          @id @default(autoincrement())
  user_id     Int
  start_date  DateTime?
  end_date    DateTime?
  status      String?
  created_at  DateTime      @default(now())

  user        USER          @relation(fields: [user_id], references: [user_id])
  dailyMeals  DAILY_MEAL[]
  carts       CART[]
}

model DAILY_MEAL {
  daily_meal_id Int                @id @default(autoincrement())
  plan_id       Int
  meal_date     DateTime?
  day_number    Int?

  plan          WEEKLY_MEAL_PLAN   @relation(fields: [plan_id], references: [plan_id])
  meals         MEAL[]
  mealCerts     MEAL_CERTIFICATION[]
}

/* ------------------------------
   üçΩ MEAL & INGREDIENTS
--------------------------------*/
model MEAL {
  meal_id        Int           @id @default(autoincrement())
  daily_meal_id  Int
  meal_type      String?
  meal_name      String?
  ingredientsId  Int?
  calories       Int?
  protein        Float?
  carbs          Float?
  fat            Float?
  recipe         String?
  image_url      String?

  dailyMeal      DAILY_MEAL    @relation(fields: [daily_meal_id], references: [daily_meal_id])
  ingredients    ingredients?  @relation(fields: [ingredientsId], references: [ingredientId])
  cartItems      CART_ITEM[]
}

model ingredients {
  ingredientId   Int       @id @default(autoincrement())
  ingredient_name String
  image_url       String?
  category_main   String?
  category_sub    String?
  division        String?
  meals           MEAL[]
  kcal            String?
  protein         String?
  fat             String?
  carbs           string?      
}

/* ------------------------------
   ‚úÖ MEAL_CERTIFICATION
--------------------------------*/
model MEAL_CERTIFICATION {
  certification_id  Int       @id @default(autoincrement())
  user_id           Int
  daily_meal_id     Int
  certification_date DateTime?
  image_url         String?
  created_at        DateTime  @default(now())

  user              USER      @relation(fields: [user_id], references: [user_id])
  dailyMeal         DAILY_MEAL @relation(fields: [daily_meal_id], references: [daily_meal_id])
}

/* ------------------------------
   üõí CART & ITEM
--------------------------------*/
model CART {
  cart_id      Int       @id @default(autoincrement())
  user_id      Int
  plan_id      Int?
  alarm_sent   Boolean   @default(false)
  created_at   DateTime  @default(now())

  user         USER      @relation(fields: [user_id], references: [user_id])
  plan         WEEKLY_MEAL_PLAN? @relation(fields: [plan_id], references: [plan_id])
  items        CART_ITEM[]
}

model CART_ITEM {
  cart_item_id    Int        @id @default(autoincrement())
  cart_id         Int
  meal_id         Int?
  ingredient_name String?
  quantity        String?

  cart            CART       @relation(fields: [cart_id], references: [cart_id])
  meal            MEAL?      @relation(fields: [meal_id], references: [meal_id])
}

/* ------------------------------
   üéü COUPON
--------------------------------*/
model COUPON {
  coupon_id      Int       @id @default(autoincrement())
  user_id        Int
  coupon_code    String
  coupon_name    String
  discount_amount Int?
  issue_date     DateTime?
  expiry_date    DateTime?
  is_used        Boolean   @default(false)

  user           USER      @relation(fields: [user_id], references: [user_id])
}

/* ------------------------------
   üí¨ POST & COMMENT
--------------------------------*/
model POST {
  post_id     Int        @id @default(autoincrement())
  user_id     Int
  title       String
  content     String
  view_count  Int        @default(0)
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  user        USER       @relation(fields: [user_id], references: [user_id])
  comments    COMMENT[]
}

model COMMENT {
  comment_id  Int       @id @default(autoincrement())
  post_id     Int
  user_id     Int
  content     String
  created_at  DateTime  @default(now())

  post        POST      @relation(fields: [post_id], references: [post_id])
  user        USER      @relation(fields: [user_id], references: [user_id])
}
